<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click the Target Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="info">
        <div id="lives-wrapper">
            <div class="lives-title">Lives: </div>
            <span id="lives"></span>
        </div>
        <div id="streak-wrapper">
            <div class="streak-title">Streak: </div>
            <span id="streak"></span>
        </div>
        <div id="exit-wrapper">
            <button id="exit">Exit</button>
        </div>
    </div>
    <div id="game-area">

    </div>

    <script>
        // Configurable variables
        let lives = 3; // Number of lives
        let targetTime = 2.0; // Countdown in seconds
        let targetSize = 100; // Diameter of the target in pixels
        let spawnDecoy = true; // Boolean for spawning decoys
        let spawnIntervalRange = [1, 3]; // Range for random spawn intervals in seconds
        let streak = 0; // Streak counter

        const gameArea = document.getElementById('game-area');
        const info = document.getElementById('info');
        const livesSpan = document.getElementById('lives');
        const streakSpan = document.getElementById('streak');

        function updateLivesDisplay() {
            livesSpan.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const life = document.createElement('span');
                life.className = 'life';
                if (i < lives) {
                    life.textContent = '❤️';
                } else {
                    life.textContent = '💔';
                    life.classList.add('lost');
                }
                livesSpan.appendChild(life);
            }
        }

        updateLivesDisplay();
        streakSpan.textContent = streak;

        function spawnTarget() {
            const isDecoy = spawnDecoy && Math.random() < 0.3; // 30% chance of a decoy
            const target = document.createElement('div');
            target.className = isDecoy ? 'decoy' : 'target';
            target.style.width = `${targetSize}px`;
            target.style.height = `${targetSize}px`;

            // Random position within the game area
            const x = Math.random() * (gameArea.clientWidth - targetSize);
            const y = Math.random() * (gameArea.clientHeight - targetSize);

            target.style.left = `${x}px`;
            target.style.top = `${y}px`;

            let countdownTime = targetTime;

            target.classList.add('fadeIn');

            // Add shrinkOutline animation with dynamic duration
            target.style.animation = `shrinkOutline ${targetTime}s linear, fadeIn 0.3s`;

            if (!isDecoy) {
                target.textContent = countdownTime.toFixed(1);
                const countdownInterval = setInterval(() => {
                    countdownTime -= 0.1;
                    target.textContent = countdownTime <= 0 ? '0' : countdownTime.toFixed(1);
                }, 100);

                setTimeout(() => {
                    clearInterval(countdownInterval);
                    if (!target.getAttribute('clicked')) {
                        // Deduct a life if missed
                        lives -= 1;
                        streak = 0; // Reset streak
                        updateLivesDisplay();
                        streakSpan.textContent = streak;
                        document.getElementById('game-area').classList.add('lost-life');
                        setTimeout(() => {
                            document.getElementById('game-area').classList.remove('lost-life');
                        }, 500);
                        if (lives <= 0) {
                            alert('Game Over!');
                            resetGame();
                        }
                        target.classList.add('fadeOut');
                        setTimeout(() => {
                            if (!target.getAttribute('clicked')) {
                                gameArea.removeChild(target);
                            }
                        }, 300);
                    }
                }, targetTime * 1000);
            } else {
                target.textContent = "💀";

                setTimeout(() => {
                    if (gameArea.contains(target)) {
                        target.classList.add('fadeOut');
                        setTimeout(() => gameArea.removeChild(target), 300);
                    }
                }, targetTime * 1000);
            }

            gameArea.appendChild(target);

            setTimeout(() => {
                target.classList.remove('fadeIn');
            }, 1);

            // Event listener for clicking the target or decoy
            target.addEventListener('click', () => {
                target.setAttribute('clicked', true);
                if (!isDecoy) {
                    streak += 1; // Increment streak
                    streakSpan.textContent = streak;
                    target.classList.add('fadeOut');
                    setTimeout(() => gameArea.removeChild(target), 300);
                } else {
                    // Penalise for clicking a red target
                    lives -= 1;
                    streak = 0; // Reset streak
                    document.getElementById('game-area').classList.add('lost-life');
                    setTimeout(() => {
                            document.getElementById('game-area').classList.remove('lost-life');
                        }, 500);
                    updateLivesDisplay();
                    streakSpan.textContent = streak;
                    if (lives <= 0) {
                        alert('Game Over!');
                        resetGame();
                    }
                    target.classList.add('fadeOut');
                    setTimeout(() => gameArea.removeChild(target), 300);
                }
            });
        }

        function resetGame() {
            lives = 3;
            streak = 0;
            updateLivesDisplay();
            streakSpan.textContent = streak;
        }

        function getRandomInterval() {
            const [min, max] = spawnIntervalRange;
            return Math.random() * (max - min) + min;
        }

        function startSpawning() {
            function spawnLoop() {
                spawnTarget();
                setTimeout(spawnLoop, getRandomInterval() * 1000);
            }
            spawnLoop();
        }

        // Start spawning targets
        startSpawning();
    </script>
</body>
</html>